syntax = "proto3";

package build.stack.gazelle.scala.jarindex;

option go_package = "github.com/stackb/scala-gazelle/build/stack/gazelle/scala/jarindex;jarindex";
option java_package = "build.stack.gazelle.scala.jarindex";
option java_multiple_files = true;
option java_outer_classname = "JarIndexSpec";

message ClassFileProvider {
    string class = 1;
    repeated string label = 2;
}

message JarIndex {
    repeated JarFile jar_file = 2 [json_name = "jarFiles"];
    repeated string predefined = 3;
    repeated string preferred = 4;
    repeated ClassFileProvider providers = 5;
}

message JarFile {
    // filename is the relative pathname of the jar file
    string filename = 1;
    // label is the fully-qualified bazel label 
    string label = 2;
    // class_file is a list of classes that are provided by the jar 
    repeated ClassFile class_file = 3  [json_name = "files"];
    // symbols is a summary set of all symbols named by all files in the jar
    repeated string symbols = 4;
    // class_name is a summary set of classes used by all files in the jar
    repeated string class_name = 5  [json_name = "classes"];
    // package_name is a summary set of packages provided by the jar
    repeated string package_name = 6  [json_name = "packages"];
}

message ClassFile {
    string name = 1;
    repeated int32 classes = 2;
    repeated string symbols = 3;
    repeated string superclasses = 4;
    repeated string interfaces = 5;
    repeated ClassField fields = 6;
    repeated ClassMethod methods = 7;
}

message ClassField {
    string name = 1;
    ClassType type = 2;
}

message ClassType {
    string kind = 1;
    string value = 2;
}

message ClassMethod {
    string name = 1;
    ClassType returns = 2;
    repeated ClassMethodParam params = 3;
    repeated ClassType types = 4;
    repeated ClassType throws = 5;
}

message ClassMethodParam {
    ClassType returns = 1;
}
